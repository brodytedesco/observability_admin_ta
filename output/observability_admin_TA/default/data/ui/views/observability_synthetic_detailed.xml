<form version="1.1" theme="dark" script="observability_synthetic.js">
  <label>Synthetic Detailed</label>
  <description>A dashboard to list all details of a synthetic retrieved via the API: https://dev.splunk.com/observability/reference/api/synthetics/latest#endpoint-retrieve-synthetics-query</description>
  <init>
    <unset token="hide"></unset>
    <set token="show_table"></set>
    <set token="json">init</set>
    <set token="json_pretty">init</set>
    <set token="id">init</set>
    <set token="type">init</set>
  </init>
  <fieldset submitButton="true" autoRun="false">
    <input type="dropdown" token="syntheticName" searchWhenChanged="true">
      <label>Synthetic Name</label>
      <default>Enter Synthetic Name</default>
      <initialValue>Enter Synthetic Name</initialValue>
      <fieldForLabel>name</fieldForLabel>
      <fieldForValue>name</fieldForValue>
      <search>
        <query>`observability_admin_index` `observability_admin_synthetic_sourcetype`   |stats latest(test.name) as name by test.name |rename test.name as name</query>
      </search>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
                        <a href="#" class="btn-pill" data-set-token="show_table" data-value="show" data-token-json="{&quot;show_modify&quot;: null, &quot;show_delete&quot;: null}">
                    View Synthetic Detailsüîé
                </a>
                                        <a href="#" class="btn-pill" data-set-token="show_modify" data-value="show" data-token-json="{&quot;show_table&quot;: null, &quot;show_delete&quot;: null}">
                    Modify Via API‚öôÔ∏è
                </a>
                                        <a href="#" class="btn-pill" data-set-token="show_delete" data-value="show" data-token-json="{&quot;show_table&quot;: null, &quot;show_modify&quot;: null}">
                    Delete Via API‚ùå    
                    </a>
                                        <a href="observability_synthetic_create" class="btn-pill">
                    Create Via API‚úîÔ∏è
                </a>
                                                        <a id="link_to_object" href="https://app.au0.signalfx.com/#/synthetics/test/view/$type$/$id$" class="btn-pill">
                    View Synthetic on O11yüîó
                </a>

      </html>
    </panel>
  </row>
  <row depends="$show_table$">
    <panel>
      <table>
        <title>details</title>
        <search>
          <query>`observability_admin_index` `observability_admin_synthetic_sourcetype`    test.name=$syntheticName|s$
|fields - host, index, linecount, punct, source, sourcetype, splunk_server, timestamp
|stats latest(*) as * by test.name
|transpose column_name="fields"
|rename "row 1" as values
|sort +fields</query>
          <earliest>-7d@h</earliest>
          <latest>now</latest>

        </search>
        
        <option name="count">15</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row depends="$show_modify$">
    <panel>
      <html>
        <p>To modify via the API we send a PUT request to the synthetic endpoint with the relevant ID and Type: https://api.{REALM}.signalfx.com/v2/synthetics/test/$type$/$id$ </p>
        <a href="https://dev.splunk.com/observability/reference/api/synthetics_http_tests/latest#endpoint-updatesinglehttptest">Reference for HTTP type synthetics</a> <br/>
        <a href="https://dev.splunk.com/observability/reference/api/synthetics_browser/latest#endpoint-updatesinglebrowsertest">Reference for Browser type synthetics</a> <br/>
        <a href="https://dev.splunk.com/observability/reference/api/synthetics_api_tests/latest#endpoint-updatesingleapitest">Reference for API type synthetics</a>
      </html>
    </panel>
  </row>
  <row depends="$show_hidden$">
    <panel>
      <table>
        <title>JSON</title>
        <search id="json_loader">
          <query>`observability_admin_index` `observability_admin_synthetic_sourcetype`    test.name=$syntheticName|s$
|stats latest(_raw) as json latest(test.id) as id latest(test.type) as type</query>
          <earliest>-7d@d</earliest>
          <latest>now</latest>
          <done>
            <set token="json">$result.json$</set>
                        <set token="id">$result.id$</set>
            <set token="type">$result.type$</set>
          </done>
        </search>
        <option name="count">15</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row depends="$show_modify$">
    <panel>
      <html>
      <p>python example</p>
      <container>
<pre>
          <code>
import json
import requests

#Credentials <p id="realm_edit">REALM = ""</p>TOKEN = ""
# API endpoints


# API endpoints
BASE_URL = f"https://api.{REALM}.signalfx.com"
ENDPOINT_URL = f"{BASE_URL}/v2/synthetic/$id$"

# Request headers
headers = {
    "Content-Type": "application/json",
    "X-SF-TOKEN": TOKEN,
}

#JSON (modify this to make changes)
synthetic_json= $json_pretty$

# Convert the request body to JSON
request_body_json = json.dumps(synthetic_json)

# Make the API request
response = requests.put(ENDPOINT_URL, headers=headers, data=request_body_json)

# Print the response
print(f"Status Code: {response.status_code}")
print("Response:")
print(response.json())
</code>
        </pre>
      </container>
    </html>
    </panel>
  </row>
  <row depends="$show_delete$">
    <panel>
      <html>
        <p>To delete via the API we send a DELETE request to the synthetic endpoint with the relevant ID: https://api.{REALM}.signalfx.com/v2/synthetic/$id$</p>
        <a>https://dev.splunk.com/observability/reference/api/synthetics/latest#endpoint-retrieve-synthetics-query</a>
      </html>
    </panel>
  </row>
  <row depends="$show_delete$">
    <panel>
      <html>
      <h1>Python Example</h1>
      <container>
<pre>
            <code>import requests

#Credentials
<p id="realm_delete">REALM = ""</p>TOKEN = ""
# API endpoints
BASE_URL = f"https://api.{REALM}.signalfx.com"
ENDPOINT_URL = f"{BASE_URL}/v2/detector/$id$"

# Request headers
headers = {
    "Content-Type": "application/json",
    "X-SF-TOKEN": TOKEN,
}

# Make the API request
response = requests.delete(ENDPOINT_URL, headers=headers)

# Print the response
print(f"Status Code: {response.status_code}")
</code>
          </pre>
      </container>
    </html>
    </panel>
  </row>

</form>